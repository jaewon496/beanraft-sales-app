<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>빈크래프트 영업관리</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { pretendard: ['Pretendard', 'sans-serif'] },
          colors: { brand: { purple: '#7C3AED', blue: '#3B82F6' } }
        }
      }
    }
  </script>
  <style>
    * { font-family: 'Pretendard', sans-serif; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; }
    .card-dark { background: #1e293b; border: 1px solid #334155; border-radius: 12px; }
    .masonry { columns: 2; column-gap: 16px; }
    .masonry > div { break-inside: avoid; margin-bottom: 16px; }
    @media (max-width: 768px) { .masonry { columns: 1; } }
    .info-icon { cursor: pointer; color: #3b82f6; font-size: 14px; }
    .info-icon:hover { color: #1d4ed8; }
    input:focus, textarea:focus { outline: none; border-color: #7C3AED; }
    .scroll-area::-webkit-scrollbar { width: 4px; }
    .scroll-area::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Gemini API 설정
    const GEMINI_API_KEY = '';
    
    // 프랜차이즈 데이터 (공정위 정보공개서 기준)
    const FRANCHISE_DATA = {
      mega: { name: '메가커피', initial: '5,800만원', royalty: '25만원/월', adFee: '11만원/월', avgSales: '4,200만원', stores: 3200, closeRate: '2.1%' },
      compose: { name: '컴포즈커피', initial: '5,500만원', royalty: '25만원/월', adFee: '5.5만원/월', avgSales: '3,800만원', stores: 2800, closeRate: '1.8%' },
      ediya: { name: '이디야', initial: '8,500만원', royalty: '없음', adFee: '30만원/월', avgSales: '3,200만원', stores: 3100, closeRate: '3.2%' },
      paik: { name: '빽다방', initial: '4,500만원', royalty: '20만원/월', adFee: '없음', avgSales: '4,500만원', stores: 1200, closeRate: '2.5%' },
      starbucks: { name: '스타벅스', initial: '직영전환', royalty: '-', adFee: '-', avgSales: '1.2억', stores: 1900, closeRate: '0.1%' },
      twosome: { name: '투썸플레이스', initial: '1.5억원', royalty: '50만원/월', adFee: '별도', avgSales: '5,500만원', stores: 1700, closeRate: '1.5%' }
    };

    // 시뮬레이션 항목 정의
    const SIM_DEFINITIONS = {
      seats: {
        title: '좌석 수',
        definition: '매장 내 동시 수용 가능한 고객 수',
        calculation: '평수 × 1.5~2 (일반적 기준)\n예: 20평 매장 → 30~40석',
        average: '소형 15~25석 / 중형 30~50석 / 대형 60석+'
      },
      price: {
        title: '객단가',
        definition: '고객 1인당 평균 결제 금액',
        calculation: '총 매출 ÷ 총 고객 수',
        average: '저가 4,000~5,000원 / 중가 6,000~8,000원 / 고가 9,000원+'
      },
      turnover: {
        title: '회전율',
        definition: '좌석 1개당 하루 평균 이용 고객 수',
        calculation: '총 고객 수 ÷ 총 좌석 수',
        average: '오피스 4~5회 / 주거 2~3회 / 대학가 2~3회 / 테이크아웃 6~10회'
      },
      occupancy: {
        title: '좌석점유율',
        definition: '전체 영업시간 중 좌석이 실제 사용된 비율',
        calculation: '(사용 좌석 × 시간) ÷ (전체 좌석 × 영업시간)',
        average: '일반 35~45% / 테이크아웃 많으면 25~35%'
      },
      rent: {
        title: '월 임대료',
        definition: '매월 지불하는 임대 비용 (보증금 제외)',
        calculation: '평당 임대료 × 평수',
        average: '서울 평당 8~15만원 / 수도권 4~8만원 / 지방 3~5만원'
      },
      labor: {
        title: '월 인건비',
        definition: '직원 급여 + 4대보험 + 퇴직금 충당',
        calculation: '시급 × 근무시간 × 30일 × 인원 × 1.15(4대보험)',
        average: '1인 기준 약 240만원 (2025년 최저시급 기준)'
      },
      materialRate: {
        title: '재료비율',
        definition: '매출 대비 원재료비 비율',
        calculation: '원재료비 ÷ 매출 × 100',
        average: '커피 중심 30~35% / 디저트 포함 35~40%'
      },
      etc: {
        title: '기타비용',
        definition: '전기, 수도, 가스, 통신, 소모품, 카드수수료 등',
        calculation: '고정비 + 변동비',
        average: '월 100~200만원 (규모에 따라)'
      }
    };

    // AI 프롬프트
    const createAnalysisPrompt = (region) => `
당신은 빈크래프트의 카페 창업 컨설턴트입니다. "${region}" 지역의 카페 창업 상권 분석을 해주세요.

반드시 아래 JSON 형식으로만 응답하세요. 다른 텍스트 없이 JSON만 출력하세요:

{
  "region": "${region}",
  "overview": {
    "cafeCount": "해당 지역 카페 수 (숫자)",
    "newOpen3m": "최근 3개월 신규 개업 수",
    "closed3m": "최근 3개월 폐업 수",
    "avgRent": "평균 임대료 (만원/월)",
    "rentChange": "전년 대비 변동률 (%)",
    "deposit": "평균 보증금 (만원)",
    "premium": "평균 권리금 (만원)"
  },
  "consumer": {
    "mainTarget": "핵심 타겟층",
    "mainTargetRatio": "비율 (%)",
    "subTarget": "2순위 타겟",
    "subTargetRatio": "비율 (%)",
    "peakTime": "피크 타임",
    "peakRatio": "피크 타임 매출 비중 (%)",
    "takeoutRatio": "테이크아웃 비중 (%)",
    "avgStay": "평균 체류시간 (분)"
  },
  "franchise": [
    {"brand": "브랜드명", "count": "매장수", "americano": "아메리카노 가격", "avgSales": "월평균매출"},
    {"brand": "브랜드명", "count": "매장수", "americano": "아메리카노 가격", "avgSales": "월평균매출"}
  ],
  "development": [
    {"title": "개발 호재 제목", "detail": "상세 내용", "timeline": "예상 시기"}
  ],
  "risks": [
    {"level": "상/중/하", "title": "리스크 제목", "solution": "대응 방안"}
  ],
  "simulation": {
    "avgPrice": "추정 객단가 (원)",
    "turnover": "추정 회전율 (회/일)",
    "occupancy": "추정 점유율 (%)",
    "laborCount": "추천 인원 (명)",
    "materialRate": "추정 재료비율 (%)"
  },
  "insight": "AI 종합 인사이트 (3~4문장)",
  "sources": ["출처1", "출처2", "출처3"]
}`;

    // 메인 앱
    function App() {
      const [currentTab, setCurrentTab] = useState('dashboard');
      const [salesMode, setSalesMode] = useState(false);
      const [lockScreen, setLockScreen] = useState(false);
      const [pin, setPin] = useState('');
      const [savedPin, setSavedPin] = useState('1234');
      
      // AI 분석 상태
      const [aiSearchQuery, setAiSearchQuery] = useState('');
      const [aiSearchResult, setAiSearchResult] = useState(null);
      const [aiLoading, setAiLoading] = useState(false);
      const [aiChatHistory, setAiChatHistory] = useState([]);
      const [aiChatInput, setAiChatInput] = useState('');

      // 영업모드 상태
      const [salesSearchQuery, setSalesSearchQuery] = useState('');
      const [salesSearchResult, setSalesSearchResult] = useState(null);
      const [salesLoading, setSalesLoading] = useState(false);
      const [salesTab, setSalesTab] = useState('analysis');
      const [simValues, setSimValues] = useState({
        seats: 20, price: 7000, turnover: 3.5, occupancy: 40,
        rent: 300, labor: 480, materialRate: 32, etc: 150
      });
      const [showInfoPopup, setShowInfoPopup] = useState(null);
      const [showSourcePopup, setShowSourcePopup] = useState(false);

      // Gemini API 호출
      const callGemini = async (prompt) => {
        if (!GEMINI_API_KEY) {
          return getMockData(prompt);
        }
        try {
          const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              generationConfig: { temperature: 0.7 }
            })
          });
          const data = await res.json();
          const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
          const jsonMatch = text.match(/\{[\s\S]*\}/);
          return jsonMatch ? JSON.parse(jsonMatch[0]) : getMockData(prompt);
        } catch (e) {
          return getMockData(prompt);
        }
      };

      // Mock 데이터 (API 없을 때)
      const getMockData = (prompt) => {
        const region = prompt.match(/"([^"]+)" 지역/)?.[1] || '검색 지역';
        return {
          region,
          overview: {
            cafeCount: '127', newOpen3m: '+8', closed3m: '-5',
            avgRent: '320', rentChange: '+4.2', deposit: '3500', premium: '6000'
          },
          consumer: {
            mainTarget: '30대 직장인', mainTargetRatio: '38',
            subTarget: '20대 대학생', subTargetRatio: '25',
            peakTime: '점심 12:00~13:30', peakRatio: '42',
            takeoutRatio: '48', avgStay: '25'
          },
          franchise: [
            { brand: '스타벅스', count: '5', americano: '4,500원', avgSales: '1.2억' },
            { brand: '메가커피', count: '3', americano: '2,000원', avgSales: '4,200만' },
            { brand: '이디야', count: '4', americano: '3,300원', avgSales: '3,200만' }
          ],
          development: [
            { title: '신규 오피스 빌딩 착공', detail: '지상 25층 규모 업무시설', timeline: '2026년 완공 예정' }
          ],
          risks: [
            { level: '중', title: '프랜차이즈 밀집도 높음', solution: '스페셜티/디저트 특화로 차별화' }
          ],
          simulation: {
            avgPrice: '7500', turnover: '3.8', occupancy: '38',
            laborCount: '2', materialRate: '32'
          },
          insight: `${region}은(는) 직장인 수요가 높은 상권으로, 점심 피크 타임에 매출이 집중됩니다. 테이크아웃 비중이 ${48}%로 높아 좌석보다 동선 최적화가 중요합니다. 임대료 상승률을 고려해 장기 계약 협상이 필요합니다.`,
          sources: ['소상공인진흥공단', '공정위 정보공개서', 'Gemini 웹검색']
        };
      };

      // 검색 실행 (AI분석 탭용)
      const handleAiSearch = async () => {
        if (!aiSearchQuery.trim()) return;
        setAiLoading(true);
        const result = await callGemini(createAnalysisPrompt(aiSearchQuery));
        setAiSearchResult(result);
        setAiLoading(false);
      };

      // 검색 실행 (영업모드용)
      const handleSalesSearch = async () => {
        if (!salesSearchQuery.trim()) return;
        setSalesLoading(true);
        const result = await callGemini(createAnalysisPrompt(salesSearchQuery));
        setSalesSearchResult(result);
        // 시뮬레이션 자동 입력
        if (result.simulation) {
          setSimValues(prev => ({
            ...prev,
            price: parseInt(result.simulation.avgPrice) || prev.price,
            turnover: parseFloat(result.simulation.turnover) || prev.turnover,
            occupancy: parseInt(result.simulation.occupancy) || prev.occupancy,
            rent: parseInt(result.overview?.avgRent) || prev.rent,
            materialRate: parseInt(result.simulation.materialRate) || prev.materialRate
          }));
        }
        setSalesLoading(false);
      };

      // 시뮬레이션 계산
      const calcSimulation = () => {
        const dailySales = simValues.seats * simValues.turnover * simValues.price * (simValues.occupancy / 100);
        const monthlySales = dailySales * 30;
        const materialCost = monthlySales * (simValues.materialRate / 100);
        const totalCost = simValues.rent * 10000 + simValues.labor * 10000 + materialCost + simValues.etc * 10000;
        const profit = monthlySales - totalCost;
        const profitRate = (profit / monthlySales * 100).toFixed(1);
        const bepCups = Math.ceil(totalCost / (simValues.price * 0.68));
        return { monthlySales, totalCost, profit, profitRate, bepCups, materialCost };
      };

      // 영업모드 잠금 해제
      const handleUnlock = () => {
        if (pin === savedPin) {
          setLockScreen(false);
          setPin('');
        }
      };

      // 영업모드 종료
      const exitSalesMode = () => {
        setLockScreen(true);
        setSalesMode(false);
      };

      // 잠금 화면
      if (lockScreen) {
        return (
          <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
            <div className="card-dark p-8 max-w-sm w-full text-center">
              <div className="w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg className="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
              </div>
              <h2 className="text-xl font-bold text-white mb-2">화면 잠금</h2>
              <p className="text-slate-400 text-sm mb-6">PIN을 입력하여 관리 화면에 접근하세요</p>
              <input
                type="password"
                maxLength={4}
                value={pin}
                onChange={(e) => setPin(e.target.value.replace(/\D/g, ''))}
                onKeyPress={(e) => e.key === 'Enter' && handleUnlock()}
                placeholder="4자리 PIN"
                className="w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-center text-white text-2xl tracking-widest mb-4"
              />
              <button onClick={handleUnlock} className="w-full py-3 bg-brand-purple text-white rounded-lg font-semibold">
                잠금 해제
              </button>
            </div>
          </div>
        );
      }

      // 영업모드
      if (salesMode) {
        const sim = calcSimulation();
        return (
          <div className="min-h-screen bg-white">
            {/* 헤더 */}
            <header className="sticky top-0 bg-white border-b border-gray-200 z-50">
              <div className="flex items-center justify-between px-4 py-3">
                <img src="logo.png" alt="빈크래프트" className="h-8" onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }} />
                <span className="hidden items-center gap-2 font-bold text-gray-900">
                  <span className="w-8 h-8 bg-brand-purple rounded-lg flex items-center justify-center text-white text-sm">BC</span>
                  빈크래프트
                </span>
                <button onClick={exitSalesMode} className="px-3 py-1.5 text-sm text-gray-600 border border-gray-300 rounded-lg">
                  종료
                </button>
              </div>
              {/* 탭 */}
              <div className="flex border-t border-gray-100">
                <button
                  onClick={() => setSalesTab('analysis')}
                  className={`flex-1 py-3 text-sm font-medium ${salesTab === 'analysis' ? 'text-brand-purple border-b-2 border-brand-purple' : 'text-gray-500'}`}
                >
                  분석
                </button>
                <button
                  onClick={() => setSalesTab('homepage')}
                  className={`flex-1 py-3 text-sm font-medium ${salesTab === 'homepage' ? 'text-brand-purple border-b-2 border-brand-purple' : 'text-gray-500'}`}
                >
                  홈페이지
                </button>
              </div>
            </header>

            {/* 분석 탭 */}
            {salesTab === 'analysis' && (
              <div className="p-4 pb-20 space-y-4">
                {/* 검색 */}
                <div className="card p-4">
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={salesSearchQuery}
                      onChange={(e) => setSalesSearchQuery(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleSalesSearch()}
                      placeholder="지역명 입력 (예: 판교, 강남역, 홍대)"
                      className="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-sm"
                    />
                    <button
                      onClick={handleSalesSearch}
                      disabled={salesLoading}
                      className="px-6 py-3 bg-brand-purple text-white rounded-lg font-medium"
                    >
                      {salesLoading ? '분석중...' : '검색'}
                    </button>
                  </div>
                </div>

                {salesSearchResult && (
                  <>
                    {/* 지역 표시 */}
                    <div className="text-center py-2">
                      <h2 className="text-lg font-bold text-gray-900">{salesSearchResult.region} 상권 분석</h2>
                      <p className="text-xs text-gray-500">{new Date().toLocaleDateString('ko-KR')} 기준</p>
                    </div>

                    {/* 1. 상권 개요 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">1. 상권 개요</h3>
                      <div className="grid grid-cols-2 gap-3 text-sm">
                        <div className="flex justify-between"><span className="text-gray-600">카페 수</span><span className="font-medium">{salesSearchResult.overview.cafeCount}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">신규 개업 (3개월)</span><span className="font-medium text-blue-600">{salesSearchResult.overview.newOpen3m}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">폐업 (3개월)</span><span className="font-medium text-red-600">{salesSearchResult.overview.closed3m}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">평균 임대료</span><span className="font-medium">{salesSearchResult.overview.avgRent}만원/월</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">임대료 변동</span><span className="font-medium">{salesSearchResult.overview.rentChange}%</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">평균 보증금</span><span className="font-medium">{salesSearchResult.overview.deposit}만원</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">평균 권리금</span><span className="font-medium">{salesSearchResult.overview.premium}만원</span></div>
                      </div>
                    </div>

                    {/* 2. 주요 소비층 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">2. 주요 소비층</h3>
                      <div className="grid grid-cols-2 gap-3 mb-3">
                        <div className="p-3 bg-gray-50 rounded-lg text-center">
                          <p className="text-xs text-gray-500">핵심 타겟</p>
                          <p className="font-bold text-gray-900">{salesSearchResult.consumer.mainTarget}</p>
                          <p className="text-sm text-brand-purple">{salesSearchResult.consumer.mainTargetRatio}%</p>
                        </div>
                        <div className="p-3 bg-gray-50 rounded-lg text-center">
                          <p className="text-xs text-gray-500">2순위</p>
                          <p className="font-bold text-gray-900">{salesSearchResult.consumer.subTarget}</p>
                          <p className="text-sm text-gray-600">{salesSearchResult.consumer.subTargetRatio}%</p>
                        </div>
                      </div>
                      <div className="space-y-2 text-sm">
                        <div className="flex justify-between"><span className="text-gray-600">피크 타임</span><span className="font-medium">{salesSearchResult.consumer.peakTime} ({salesSearchResult.consumer.peakRatio}%)</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">테이크아웃 비중</span><span className="font-medium">{salesSearchResult.consumer.takeoutRatio}%</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">평균 체류시간</span><span className="font-medium">{salesSearchResult.consumer.avgStay}분</span></div>
                      </div>
                    </div>

                    {/* 3. 프랜차이즈 경쟁 현황 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">3. 프랜차이즈 경쟁 현황</h3>
                      <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="border-b border-gray-200">
                              <th className="py-2 text-left text-gray-600 font-medium">브랜드</th>
                              <th className="py-2 text-center text-gray-600 font-medium">매장수</th>
                              <th className="py-2 text-center text-gray-600 font-medium">아메리카노</th>
                              <th className="py-2 text-right text-gray-600 font-medium">월매출</th>
                            </tr>
                          </thead>
                          <tbody>
                            {salesSearchResult.franchise.map((f, i) => (
                              <tr key={i} className="border-b border-gray-100">
                                <td className="py-2 font-medium">{f.brand}</td>
                                <td className="py-2 text-center">{f.count}개</td>
                                <td className="py-2 text-center">{f.americano}</td>
                                <td className="py-2 text-right">{f.avgSales}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    {/* 4. 개발 호재 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">4. 개발 호재</h3>
                      <div className="space-y-3">
                        {salesSearchResult.development.map((d, i) => (
                          <div key={i} className="p-3 bg-blue-50 rounded-lg">
                            <p className="font-medium text-gray-900">{d.title}</p>
                            <p className="text-sm text-gray-600 mt-1">{d.detail}</p>
                            <p className="text-xs text-blue-600 mt-1">{d.timeline}</p>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* 5. 리스크 요인 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">5. 리스크 요인</h3>
                      <div className="space-y-3">
                        {salesSearchResult.risks.map((r, i) => (
                          <div key={i} className="p-3 bg-red-50 rounded-lg">
                            <div className="flex items-center gap-2">
                              <span className={`px-2 py-0.5 text-xs font-medium rounded ${r.level === '상' ? 'bg-red-200 text-red-700' : r.level === '중' ? 'bg-yellow-200 text-yellow-700' : 'bg-gray-200 text-gray-700'}`}>
                                {r.level}
                              </span>
                              <span className="font-medium text-gray-900">{r.title}</span>
                            </div>
                            <p className="text-sm text-gray-600 mt-2">→ {r.solution}</p>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* 6. 수익 시뮬레이션 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">6. 수익 시뮬레이션</h3>
                      <p className="text-xs text-blue-600 bg-blue-50 px-3 py-2 rounded-lg mb-4">
                        {salesSearchResult.region} 데이터 기반 자동 입력됨
                      </p>
                      
                      {/* 매장 정보 */}
                      <div className="space-y-3 mb-4">
                        <p className="text-sm font-medium text-gray-700">매장 정보</p>
                        {[
                          { key: 'seats', label: '좌석 수', unit: '석', type: 'seats' },
                          { key: 'price', label: '객단가', unit: '원', type: 'price' },
                          { key: 'turnover', label: '회전율', unit: '회/일', type: 'turnover' },
                          { key: 'occupancy', label: '좌석점유율', unit: '%', type: 'occupancy' }
                        ].map(item => (
                          <div key={item.key} className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <span className="text-sm text-gray-600">{item.label}</span>
                              <button onClick={() => setShowInfoPopup(item.type)} className="info-icon">i</button>
                            </div>
                            <div className="flex items-center gap-2">
                              <input
                                type="number"
                                value={simValues[item.key]}
                                onChange={(e) => setSimValues({ ...simValues, [item.key]: parseFloat(e.target.value) || 0 })}
                                className="w-24 px-3 py-2 border border-gray-300 rounded-lg text-right text-sm"
                              />
                              <span className="text-sm text-gray-500 w-12">{item.unit}</span>
                            </div>
                          </div>
                        ))}
                      </div>

                      {/* 비용 정보 */}
                      <div className="space-y-3 mb-4">
                        <p className="text-sm font-medium text-gray-700">비용 정보</p>
                        {[
                          { key: 'rent', label: '월 임대료', unit: '만원', type: 'rent' },
                          { key: 'labor', label: '월 인건비', unit: '만원', type: 'labor' },
                          { key: 'materialRate', label: '재료비율', unit: '%', type: 'materialRate' },
                          { key: 'etc', label: '기타비용', unit: '만원', type: 'etc' }
                        ].map(item => (
                          <div key={item.key} className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <span className="text-sm text-gray-600">{item.label}</span>
                              <button onClick={() => setShowInfoPopup(item.type)} className="info-icon">i</button>
                            </div>
                            <div className="flex items-center gap-2">
                              <input
                                type="number"
                                value={simValues[item.key]}
                                onChange={(e) => setSimValues({ ...simValues, [item.key]: parseFloat(e.target.value) || 0 })}
                                className="w-24 px-3 py-2 border border-gray-300 rounded-lg text-right text-sm"
                              />
                              <span className="text-sm text-gray-500 w-12">{item.unit}</span>
                            </div>
                          </div>
                        ))}
                      </div>

                      {/* 결과 */}
                      <div className="bg-gray-50 rounded-lg p-4 space-y-3">
                        <div className="text-center">
                          <p className="text-sm text-gray-600">월 예상 매출</p>
                          <p className="text-2xl font-bold text-brand-purple">{(sim.monthlySales / 10000).toFixed(0)}만원</p>
                        </div>
                        <div className="grid grid-cols-3 gap-2 text-center">
                          <div className="p-2 bg-white rounded-lg">
                            <p className="text-xs text-gray-500">월 비용</p>
                            <p className="font-bold text-gray-900">{(sim.totalCost / 10000).toFixed(0)}만</p>
                          </div>
                          <div className="p-2 bg-white rounded-lg">
                            <p className="text-xs text-gray-500">월 순이익</p>
                            <p className={`font-bold ${sim.profit > 0 ? 'text-blue-600' : 'text-red-600'}`}>{(sim.profit / 10000).toFixed(0)}만</p>
                          </div>
                          <div className="p-2 bg-white rounded-lg">
                            <p className="text-xs text-gray-500">순이익률</p>
                            <p className="font-bold text-gray-900">{sim.profitRate}%</p>
                          </div>
                        </div>
                        <div className="pt-3 border-t border-gray-200">
                          <p className="text-sm text-gray-600">손익분기점: 하루 <span className="font-bold text-gray-900">{Math.ceil(sim.bepCups / 30)}잔</span></p>
                        </div>
                      </div>
                    </div>

                    {/* 7. 컨설팅 효과 비교 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">7. 컨설팅 효과 비교</h3>
                      <div className="grid grid-cols-2 gap-3">
                        <div className="p-3 bg-green-50 rounded-lg text-center">
                          <p className="text-xs text-green-600 mb-2">컨설팅 O</p>
                          <p className="text-sm">3년 생존율 <span className="font-bold">72%</span></p>
                          <p className="text-sm">손익분기 <span className="font-bold">4개월</span></p>
                          <p className="text-sm">재방문율 <span className="font-bold">68%</span></p>
                        </div>
                        <div className="p-3 bg-gray-100 rounded-lg text-center">
                          <p className="text-xs text-gray-500 mb-2">컨설팅 X</p>
                          <p className="text-sm">3년 생존율 <span className="font-bold">39%</span></p>
                          <p className="text-sm">손익분기 <span className="font-bold">7개월</span></p>
                          <p className="text-sm">재방문율 <span className="font-bold">41%</span></p>
                        </div>
                      </div>
                      <p className="text-xs text-gray-500 mt-3 text-center">중소벤처기업부 창업지원 효과분석 2024</p>
                    </div>

                    {/* 8. AI 인사이트 */}
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">8. AI 인사이트</h3>
                      <div className="p-4 bg-purple-50 rounded-lg">
                        <p className="text-sm text-gray-700 leading-relaxed">{salesSearchResult.insight}</p>
                      </div>
                      <p className="text-xs text-gray-400 mt-3 text-center">본 분석은 참고용이며 실제 수익을 보장하지 않습니다.</p>
                    </div>

                    {/* 출처 버튼 */}
                    <button
                      onClick={() => setShowSourcePopup(true)}
                      className="w-full py-3 text-sm text-gray-500 border border-gray-200 rounded-lg"
                    >
                      출처 보기
                    </button>
                  </>
                )}

                {!salesSearchResult && !salesLoading && (
                  <div className="text-center py-12 text-gray-500">
                    <p>지역명을 입력하여 상권 분석을 시작하세요</p>
                  </div>
                )}
              </div>
            )}

            {/* 홈페이지 탭 */}
            {salesTab === 'homepage' && (
              <div className="h-[calc(100vh-120px)]">
                <iframe
                  src="https://beancraft.co.kr"
                  className="w-full h-full border-0"
                  title="빈크래프트 홈페이지"
                />
              </div>
            )}

            {/* 정보 팝업 */}
            {showInfoPopup && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowInfoPopup(null)}>
                <div className="bg-white rounded-xl max-w-sm w-full p-5" onClick={e => e.stopPropagation()}>
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-bold text-gray-900">{SIM_DEFINITIONS[showInfoPopup]?.title}</h3>
                    <button onClick={() => setShowInfoPopup(null)} className="text-gray-400">✕</button>
                  </div>
                  <div className="space-y-4 text-sm">
                    <div>
                      <p className="text-gray-500 mb-1">정의</p>
                      <p className="text-gray-900">{SIM_DEFINITIONS[showInfoPopup]?.definition}</p>
                    </div>
                    <div>
                      <p className="text-gray-500 mb-1">계산법</p>
                      <p className="text-gray-900 whitespace-pre-line">{SIM_DEFINITIONS[showInfoPopup]?.calculation}</p>
                    </div>
                    <div>
                      <p className="text-gray-500 mb-1">상권별 기준</p>
                      <p className="text-gray-900">{SIM_DEFINITIONS[showInfoPopup]?.average}</p>
                    </div>
                    {salesSearchResult && (
                      <div className="p-3 bg-blue-50 rounded-lg">
                        <p className="text-xs text-blue-600 mb-1">{salesSearchResult.region} 기준</p>
                        <p className="font-medium text-gray-900">
                          {showInfoPopup === 'price' && `추정 객단가: ${salesSearchResult.simulation.avgPrice}원`}
                          {showInfoPopup === 'turnover' && `추정 회전율: ${salesSearchResult.simulation.turnover}회`}
                          {showInfoPopup === 'occupancy' && `추정 점유율: ${salesSearchResult.simulation.occupancy}%`}
                          {showInfoPopup === 'rent' && `평균 임대료: ${salesSearchResult.overview.avgRent}만원`}
                          {showInfoPopup === 'materialRate' && `추정 재료비율: ${salesSearchResult.simulation.materialRate}%`}
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* 출처 팝업 */}
            {showSourcePopup && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowSourcePopup(false)}>
                <div className="bg-white rounded-xl max-w-sm w-full p-5" onClick={e => e.stopPropagation()}>
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-bold text-gray-900">출처</h3>
                    <button onClick={() => setShowSourcePopup(false)} className="text-gray-400">✕</button>
                  </div>
                  <div className="space-y-3 text-sm">
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="font-medium text-gray-900 mb-1">상권 정보</p>
                      <p className="text-gray-600">소상공인시장진흥공단 상권정보시스템</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="font-medium text-gray-900 mb-1">프랜차이즈 정보</p>
                      <p className="text-gray-600">공정거래위원회 정보공개서 (2024)</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="font-medium text-gray-900 mb-1">임대료/부동산</p>
                      <p className="text-gray-600">한국부동산원, 네이버 부동산</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="font-medium text-gray-900 mb-1">트렌드/뉴스</p>
                      <p className="text-gray-600">Gemini 웹검색 (실시간)</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="font-medium text-gray-900 mb-1">컨설팅 효과</p>
                      <p className="text-gray-600">중소벤처기업부 창업지원 효과분석 (2024)</p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // 메인 영업관리 사이트
      const tabs = [
        { id: 'dashboard', label: '대시보드' },
        { id: 'ai', label: 'AI분석' },
        { id: 'schedule', label: '일정' },
        { id: 'clients', label: '고객' },
        { id: 'settings', label: '설정' }
      ];

      return (
        <div className="min-h-screen bg-gray-50">
          {/* 헤더 */}
          <header className="bg-white border-b border-gray-200 sticky top-0 z-40">
            <div className="flex items-center justify-between px-4 py-3">
              <div className="flex items-center gap-2">
                <img src="logo.png" alt="빈크래프트" className="h-8" onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }} />
                <span className="hidden items-center gap-2 font-bold text-gray-900">
                  <span className="w-8 h-8 bg-brand-purple rounded-lg flex items-center justify-center text-white text-sm">BC</span>
                  영업관리
                </span>
              </div>
              <button
                onClick={() => setSalesMode(true)}
                className="px-4 py-2 bg-brand-purple text-white text-sm font-medium rounded-lg"
              >
                영업모드
              </button>
            </div>
            {/* 탭 */}
            <div className="flex overflow-x-auto">
              {tabs.map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setCurrentTab(tab.id)}
                  className={`flex-shrink-0 px-4 py-3 text-sm font-medium ${
                    currentTab === tab.id
                      ? 'text-brand-purple border-b-2 border-brand-purple'
                      : 'text-gray-500'
                  }`}
                >
                  {tab.label}
                </button>
              ))}
            </div>
          </header>

          {/* 콘텐츠 */}
          <main className="p-4 pb-20">
            {/* 대시보드 */}
            {currentTab === 'dashboard' && (
              <div className="masonry">
                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">오늘의 일정</h3>
                  <div className="space-y-2">
                    <div className="flex items-center gap-3 p-2 bg-gray-50 rounded-lg">
                      <div className="w-2 h-2 bg-brand-purple rounded-full"></div>
                      <div>
                        <p className="text-sm font-medium text-gray-900">강남 중개사 미팅</p>
                        <p className="text-xs text-gray-500">14:00 - 15:00</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-3 p-2 bg-gray-50 rounded-lg">
                      <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                      <div>
                        <p className="text-sm font-medium text-gray-900">신규 상담 - 홍길동</p>
                        <p className="text-xs text-gray-500">16:00 - 17:00</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">이번 주 영업 현황</h3>
                  <div className="grid grid-cols-2 gap-3">
                    <div className="text-center p-3 bg-purple-50 rounded-lg">
                      <p className="text-2xl font-bold text-brand-purple">12</p>
                      <p className="text-xs text-gray-600">미팅</p>
                    </div>
                    <div className="text-center p-3 bg-blue-50 rounded-lg">
                      <p className="text-2xl font-bold text-blue-600">5</p>
                      <p className="text-xs text-gray-600">계약</p>
                    </div>
                  </div>
                </div>

                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">최근 상담</h3>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-700">김철수</span>
                      <span className="text-xs text-gray-500">강남구</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-700">이영희</span>
                      <span className="text-xs text-gray-500">마포구</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-700">박민수</span>
                      <span className="text-xs text-gray-500">판교</span>
                    </div>
                  </div>
                </div>

                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">월간 목표</h3>
                  <div className="space-y-3">
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-600">계약 목표</span>
                        <span className="font-medium">5/10건</span>
                      </div>
                      <div className="h-2 bg-gray-100 rounded-full">
                        <div className="h-2 bg-brand-purple rounded-full" style={{width: '50%'}}></div>
                      </div>
                    </div>
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-600">미팅 목표</span>
                        <span className="font-medium">18/20건</span>
                      </div>
                      <div className="h-2 bg-gray-100 rounded-full">
                        <div className="h-2 bg-blue-500 rounded-full" style={{width: '90%'}}></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* AI분석 탭 */}
            {currentTab === 'ai' && (
              <div className="space-y-4">
                {/* 지역 검색 (영업모드와 동일) */}
                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">지역 상권 분석</h3>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={aiSearchQuery}
                      onChange={(e) => setAiSearchQuery(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleAiSearch()}
                      placeholder="지역명 입력 (예: 판교, 강남역, 홍대)"
                      className="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-sm"
                    />
                    <button
                      onClick={handleAiSearch}
                      disabled={aiLoading}
                      className="px-6 py-3 bg-brand-purple text-white rounded-lg font-medium"
                    >
                      {aiLoading ? '분석중...' : '검색'}
                    </button>
                  </div>
                </div>

                {/* 검색 결과 */}
                {aiSearchResult && (
                  <div className="masonry">
                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-1">{aiSearchResult.region} 상권 분석</h3>
                      <p className="text-xs text-gray-500 mb-3">{new Date().toLocaleDateString('ko-KR')} 기준</p>
                      <div className="space-y-2 text-sm">
                        <div className="flex justify-between"><span className="text-gray-600">카페 수</span><span className="font-medium">{aiSearchResult.overview.cafeCount}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">신규 개업</span><span className="font-medium text-blue-600">{aiSearchResult.overview.newOpen3m}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">폐업</span><span className="font-medium text-red-600">{aiSearchResult.overview.closed3m}개</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">평균 임대료</span><span className="font-medium">{aiSearchResult.overview.avgRent}만원</span></div>
                      </div>
                    </div>

                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">주요 소비층</h3>
                      <div className="space-y-2">
                        <div className="p-2 bg-purple-50 rounded-lg">
                          <div className="flex justify-between">
                            <span className="text-sm font-medium">{aiSearchResult.consumer.mainTarget}</span>
                            <span className="text-sm text-brand-purple">{aiSearchResult.consumer.mainTargetRatio}%</span>
                          </div>
                        </div>
                        <div className="p-2 bg-gray-50 rounded-lg">
                          <div className="flex justify-between">
                            <span className="text-sm">{aiSearchResult.consumer.subTarget}</span>
                            <span className="text-sm text-gray-600">{aiSearchResult.consumer.subTargetRatio}%</span>
                          </div>
                        </div>
                      </div>
                      <div className="mt-3 text-sm space-y-1">
                        <p className="text-gray-600">피크 타임: <span className="text-gray-900">{aiSearchResult.consumer.peakTime}</span></p>
                        <p className="text-gray-600">테이크아웃: <span className="text-gray-900">{aiSearchResult.consumer.takeoutRatio}%</span></p>
                      </div>
                    </div>

                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">프랜차이즈 현황</h3>
                      <div className="space-y-2">
                        {aiSearchResult.franchise.map((f, i) => (
                          <div key={i} className="flex justify-between items-center text-sm">
                            <span className="font-medium">{f.brand}</span>
                            <span className="text-gray-600">{f.count}개 / {f.avgSales}</span>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">AI 인사이트</h3>
                      <p className="text-sm text-gray-700 leading-relaxed">{aiSearchResult.insight}</p>
                    </div>

                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">리스크 요인</h3>
                      <div className="space-y-2">
                        {aiSearchResult.risks.map((r, i) => (
                          <div key={i} className="p-2 bg-red-50 rounded-lg">
                            <div className="flex items-center gap-2 mb-1">
                              <span className={`px-1.5 py-0.5 text-xs font-medium rounded ${r.level === '상' ? 'bg-red-200 text-red-700' : 'bg-yellow-200 text-yellow-700'}`}>{r.level}</span>
                              <span className="text-sm font-medium">{r.title}</span>
                            </div>
                            <p className="text-xs text-gray-600">{r.solution}</p>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="card p-4">
                      <h3 className="font-bold text-gray-900 mb-3">개발 호재</h3>
                      <div className="space-y-2">
                        {aiSearchResult.development.map((d, i) => (
                          <div key={i} className="p-2 bg-blue-50 rounded-lg">
                            <p className="text-sm font-medium">{d.title}</p>
                            <p className="text-xs text-gray-600">{d.detail}</p>
                            <p className="text-xs text-blue-600 mt-1">{d.timeline}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {/* AI 채팅 */}
                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-3">AI 영업 코치</h3>
                  <div className="h-64 overflow-y-auto scroll-area bg-gray-50 rounded-lg p-3 mb-3 space-y-3">
                    {aiChatHistory.length === 0 && (
                      <div className="text-center text-gray-500 text-sm py-8">
                        <p>영업 상황이나 멘트를 입력하면</p>
                        <p>AI가 피드백을 드립니다</p>
                      </div>
                    )}
                    {aiChatHistory.map((chat, i) => (
                      <div key={i}>
                        {chat.input && (
                          <div className="flex justify-end mb-2">
                            <div className="bg-brand-purple text-white px-3 py-2 rounded-lg text-sm max-w-[80%]">
                              {chat.input}
                            </div>
                          </div>
                        )}
                        {chat.response && (
                          <div className="flex justify-start">
                            <div className="bg-white border border-gray-200 px-3 py-2 rounded-lg text-sm max-w-[80%] whitespace-pre-line">
                              {chat.response}
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={aiChatInput}
                      onChange={(e) => setAiChatInput(e.target.value)}
                      onKeyPress={(e) => {
                        if (e.key === 'Enter' && aiChatInput.trim()) {
                          const input = aiChatInput.trim();
                          setAiChatInput('');
                          let response = '';
                          if (input.includes('중개사') || input.includes('부동산')) {
                            response = '중개사 영업 포인트입니다.\n\n핵심:\n- 프랜차이즈보다 매물 조건이 유연하다는 점 강조\n- "기존 매물 그대로 소개만 해주시면 됩니다"\n\n추천 멘트:\n"프랜차이즈 영업팀은 조건 까다롭잖아요. 저희는 선생님 매물 그대로 됩니다."';
                          } else if (input.includes('프랜차이즈') || input.includes('거절')) {
                            response = '프랜차이즈 선호 고객 대응법입니다.\n\n추천 멘트:\n"프랜차이즈도 좋은 선택이죠. 근데 정보공개서 보셨어요? 5년 로열티 3천만 원인 거 아시죠?"\n\n비용 비교로 자연스럽게 유도하세요.';
                          } else {
                            response = '더 구체적인 상황을 알려주시면 맞춤 피드백 드릴게요.\n\n예시:\n- 중개사한테 ㅇㅇ멘트 썼는데...\n- 고객이 프랜차이즈로 하겠다고 해서...\n- 강남 지역 영업 어떻게 해야 할까요?';
                          }
                          setAiChatHistory([...aiChatHistory, { input, response }]);
                        }
                      }}
                      placeholder="영업 상황이나 멘트를 입력하세요"
                      className="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm"
                    />
                    <button
                      onClick={() => {
                        if (aiChatInput.trim()) {
                          const input = aiChatInput.trim();
                          setAiChatInput('');
                          let response = '피드백을 준비 중입니다...';
                          setAiChatHistory([...aiChatHistory, { input, response }]);
                        }
                      }}
                      className="px-4 py-2 bg-brand-purple text-white rounded-lg text-sm"
                    >
                      전송
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* 일정 탭 */}
            {currentTab === 'schedule' && (
              <div className="card p-4">
                <h3 className="font-bold text-gray-900 mb-4">일정 관리</h3>
                <p className="text-gray-500 text-center py-8">캘린더 기능 준비 중</p>
              </div>
            )}

            {/* 고객 탭 */}
            {currentTab === 'clients' && (
              <div className="card p-4">
                <h3 className="font-bold text-gray-900 mb-4">고객 관리</h3>
                <p className="text-gray-500 text-center py-8">고객 목록 기능 준비 중</p>
              </div>
            )}

            {/* 설정 탭 */}
            {currentTab === 'settings' && (
              <div className="space-y-4">
                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-4">계정 설정</h3>
                  <div className="space-y-3">
                    <div>
                      <label className="text-sm text-gray-600">PIN 설정</label>
                      <input
                        type="password"
                        maxLength={4}
                        value={savedPin}
                        onChange={(e) => setSavedPin(e.target.value.replace(/\D/g, ''))}
                        className="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg"
                        placeholder="4자리 숫자"
                      />
                    </div>
                  </div>
                </div>

                <div className="card p-4">
                  <h3 className="font-bold text-gray-900 mb-4">API 설정</h3>
                  <p className="text-sm text-gray-500">Gemini API 키가 설정되지 않으면 샘플 데이터가 표시됩니다.</p>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
